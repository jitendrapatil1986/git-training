@using Warranty.UI.Core.Helpers
@model Warranty.Core.Features.ServiceCallsWidget.ServiceCallsWidgetModel

@if (!Model.OverdueServiceCalls.Any())
{
    <div class="well-sm">
        <em>No calls are overdue. Hooray!</em>
    </div>
}
else
{
<div class="panel-group" id="overdue_list">
    @foreach (var employee in Model.RepresentativesWithOverdueCalls)
    {
        <div class="panel list-group-item">
            <a data-toggle="collapse" data-parent="#overdue_list" href="#collapse@(employee.EmployeeNumber)" class="text-capitalize accordion-toggle collapsed">@employee.Name</a> <span class="badge">@employee.ServiceCallsCount</span>
            <div id="collapse@(employee.EmployeeNumber)" class="collapse panel-body">
                @foreach (var line in Model.OverdueServiceCalls.Where(x => x.AssignedToEmployeeNumber == employee.EmployeeNumber))
                {
                    <div class="service-call-line">
                        <div class="col-md-3">
                            <small class="text-muted">@line.CallNumber</small>
                            <small class="pull-right text-muted">@Format.DateMonthDay(line.CreatedDate)</small>
                        </div>
                        <div class="col-md-5">
                            <div class="col-md-1 hidden-sm hidden-xs">
                                @Format.WithTooltip(@Format.NumberOfLineItems(line.NumberOfLineItems).ToString(), "Number of line items", false)
                            </div>
                            <div class="col-md-10">
                                <a>@line.HomeownerName</a><br />
                                @line.Address<br/>
                            </div>
                        </div>
                        <div class="col-md-3">
                            @Format.PhoneNumber(line.PhoneNumber)<br/>
                        </div>
                        <div class="col-md-1 text-center">
                            <button type="button" class="btn btn-default dropdown-toggle pull-right" data-toggle="dropdown"><span class="glyphicon glyphicon-cog"></span></button>
                            <ul class="dropdown-menu" role="menu">
                                <li>@Html.ActionLink("Reassign", "Reassign", "ServiceCall", new {id = @line.ServiceCallId}, null)</li>
                                <li>@Html.ActionLink("Request Payment", "RequestPayment", "ServiceCall", new {id = @line.ServiceCallId}, null)</li>
                                <li>@Html.ActionLink("Add Note", "AddNote", "ServiceCall", new {id = @line.ServiceCallId}, null)</li>
                                <li>@Html.ActionLink("Close", "Close", "ServiceCall", new {id = @line.ServiceCallId}, null)</li>
                            </ul>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                }
            </div>
        </div>

    }
</div>
}