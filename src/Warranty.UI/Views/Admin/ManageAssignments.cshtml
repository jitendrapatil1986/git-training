@using System.Linq
@using Warranty.Core.Extensions
@model Warranty.Core.Features.AssignWSRs.AssignWSRsModel

@{
    ViewBag.Title = "Assign WSR's";
}

<h2>Assign WSR's</h2>
@*@using (Html.BeginForm("ManageAssignments"))
{
    <span>Community:</span>
    @Html.DropDownListFor(x => x.SelectedCommunityId, Model.Communities.Select(c => new SelectListItem {Text = c.Name, Value = c.Id.ToString()}))
    @Html.ValidationMessageFor(x=>x.SelectedCommunityId)
    <span>Employee:</span>
    @Html.DropDownListFor(x => x.SelectedEmployeeId, Model.Employees.Select(c => new SelectListItem {Text = c.Name, Value = c.EmployeeId.ToString()}))
    @Html.ValidationMessageFor(x=>x.SelectedEmployeeId)
    <input type="submit" value="Add" class="btn btn-success"/>
}*@


@*<div id="bloodhound">
    <input class="typeahead" type="text" placeholder="States of USA">
</div>*@

@*<div id="employeeList">
    <input id="employeeSearch" class="typeahead" type="text" placeholder="Employee List">
</div>*@


@*@Html.DropDownListFor(x => x.SelectedEmployeeId, Model.Employees.Select(c => new SelectListItem {Text = c.Name, Value = c.EmployeeId.ToString()}), new{@class="combobox"})*@
@*<select class="combobox dropdown-menu input-large form-control" data-bind="options: theLookups, value: selectedEmployeeId, optionsText: 'employeeName', optionsValue: 'employeeId', optionsCaption: 'Select Assignee'"></select>*@


@*<select class="combobox input-large form-control" style="display: none;">
    <option value="" selected="selected">Select a State</option>
    <option value="AL">Alabama</option>
    <option value="AK">Alaska</option>
    <option value="AZ">Arizona</option>
    <option value="AR">Arkansas</option>
    <option value="CA">California</option>
    <option value="CO">Colorado</option>
    <option value="CT">Connecticut</option>
    <option value="DE">Delaware</option>
    <option value="DC">District Of Columbia</option>
    <option value="FL">Florida</option>
    <option value="GA">Georgia</option>
    <option value="HI">Hawaii</option>
    <option value="ID">Idaho</option>
    <option value="IL">Illinois</option>
    <option value="IN">Indiana</option>
    <option value="IA">Iowa</option>
    <option value="KS">Kansas</option>
    <option value="KY">Kentucky</option>
    <option value="LA">Louisiana</option>
    <option value="ME">Maine</option>
    <option value="MD">Maryland</option>
    <option value="MA">Massachusetts</option>
    <option value="MI">Michigan</option>
    <option value="MN">Minnesota</option>
    <option value="MS">Mississippi</option>
    <option value="MO">Missouri</option>
    <option value="MT">Montana</option>
    <option value="NE">Nebraska</option>
    <option value="NV">Nevada</option>
    <option value="NH">New Hampshire</option>
    <option value="NJ">New Jersey</option>
    <option value="NM">New Mexico</option>
    <option value="NY">New York</option>
    <option value="NC">North Carolina</option>
    <option value="ND">North Dakota</option>
    <option value="OH">Ohio</option>
    <option value="OK">Oklahoma</option>
    <option value="OR">Oregon</option>
    <option value="PA">Pennsylvania</option>
    <option value="RI">Rhode Island</option>
    <option value="SC">South Carolina</option>
    <option value="SD">South Dakota</option>
    <option value="TN">Tennessee</option>
    <option value="TX">Texas</option>
    <option value="UT">Utah</option>
    <option value="VT">Vermont</option>
    <option value="VA">Virginia</option>
    <option value="WA">Washington</option>
    <option value="WV">West Virginia</option>
    <option value="WI">Wisconsin</option>
    <option value="WY">Wyoming</option>
</select>*@


@*<div class="input-group">
    <input id="searchBar" name="query" type="text" class="form-control main-search" autocomplete="off" placeholder=""/>
    <div class="input-group-addon"><span class="glyphicon glyphicon-search"></span></div>
</div>*@

<div class="container">
    <div id="communities">
        <div class="col-md-4">
            <div class="searchContainer">
                <label for="search">Search</label>
                <input id="search" name="search" type="text" class="form-control" data-list=".default_list" autocomplete="off">
            </div>
        </div>
        <div class="row"></div>
        <ul class="default_list row" data-bind="foreach: allCommunityAssignments">
            <li class="col-md-4">
                <div class="itemContainer">
                    <h3 data-bind="text: communityName"></h3>
                    <div class="communityDesc row" data-bind="attr: {'data-manage-assignment-line-item': $index() + 1}">
                        <div class="col-md-8">
                            <div class="hidden" data-bind="text: communityAssignmentId()"></div>
                            <label>Assignee</label>
                            @*@Html.DropDownListFor(x => x.SelectedEmployeeId, Model.Employees.Select(c => new SelectListItem {Text = c.Name, Value = c.EmployeeId.ToString()}), new{@class="combobox"})
                                <select id="employeeAssignList" class="combobox form-control" data-bind="options: theLookups, value: employeeId, optionsText: 'employeeName', optionsValue: 'employeeId', optionsCaption: 'Select Assignee'"></select>*@
                    
                            @*<select id="employeeAssignList" class="combobox form-control" data-bind="options: communityEmployeeLookups, value: selectedEmployeeId, optionsText: 'employeeName', optionsValue: 'employeeId', optionsCaption: 'Select Assignee'"></select>*@
                            @*<span data-bind="text: selectedEmployeeId()"></span>*@
                            @*<select id="updateCommunityAssignee" class="dropdown form-control" data-bind="options: communityEmployeeLookups, value: selectedEmployeeId, optionsText: 'employeeName', optionsValue: 'employeeId', optionsCaption: 'Select Assignee'"></select>*@

                            <div>
                                <a href="#" data-bind="text: selectedEmployeeName(), click: editLine, visible: selectedEmployeeName() != ''" class=""></a>
                                <a href="#" data-bind="click: editLine, visible: selectedEmployeeName() == ''" class="">Unassigned</a>
                            </div>
                            <div id="employeeList">
                                <input id="employeeSearch" class="typeahead form-control" type="text" placeholder="Unassigned">
                            </div>
                            <div id="selectedLineEmployeeId" class="hidden" data-bind="value: selectedEmployeeId"></div>
                        </div>
                        <div class="col-md-4 text-right">
                            <button type="button" class="btn btn-primary" data-bind="visible: selectedEmployeeName() != '', click: assignEmployeeToCommunity">Assign</button>
                        </div>
                    </div>
                </div>
            </li>
        </ul>


        @*<ul class="default_list row">
            @foreach (var com in Model.Communities.Where(c => c.Employees.Any()))
            {
                <li class="col-md-4">
                    <div class="itemContainer">
                        <h3>@com.Name</h3>
                        <div class="communityDesc row">
                            <div class="col-md-8">
                                <label>Assignee</label>
                                <div class="info"><a href="#">Unassigned</a></div>
                            </div>
                            <div class="col-md-4 text-right">
                                <button type="button" class="btn btn-primary">Assign</button>
                            </div>
                        </div>
                    </div>
                </li>
            }
        </ul>*@
    </div>
</div>

@*<div class="well">
    <h2>Assignments</h2>

    @if (!Model.Communities.Any(c => c.Employees.Any()))
    {
        <div>No assignments found.</div>
    }

    @foreach (var com in Model.Communities.Where(c => c.Employees.Any()))
    {
        <div  class="list-group col-md-12">
            <div class="list-group-item">
                @com.Name
            </div>
            @foreach (var emp in com.Employees)
            {
                <div>
                    <span class="list-group-item">
                        @emp.Name
                        <a href="#" class="pull-right glyphicon glyphicon-remove" data-assignmentId="@emp.EmployeeAssignmentId"></a>
                    </span>
                </div>
            }
        </div>
    }

    <div class="clearfix"></div>
</div>*@

@section modules
{
    <script>
        define('modelData', function() {
            return {
                initialCommunityAssignmentLines: @Html.Raw(Model.Communities.ToJson())
            }
        });
        
        define('dropdownData', function() {
            return {
                availableLookups: @Html.Raw(Model.Employees.Select(x => new { employeeName = x.Name, employeeId = x.EmployeeId }).ToJson())
                                                                                                @*availableLookups: @Html.Raw(Model.Employees.Select(c => new SelectListItem {Text = c.Name, Value = c.EmployeeId.ToString()}))*@
            };
        });
    </script>
}

<a href="~/css/less/combobox.less">~/css/less/combobox.less</a>
<link href="~/css/bootstrap-combobox.css" rel="stylesheet" />

<script src="~/Scripts/lib/jquery-1.10.2.min.js"></script>
@*<script src="~/Scripts/lib/jquery.hideseek.min.js"></script>*@
<script src="~/Scripts/lib/bootstrap-combobox.js"></script>

<script>
    $(function() {
        $('.combobox').combobox();
    });
</script>